<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Informa√ß√µes - Servidores Minecraft</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">Painel Minecraft</a>
            <div class="navbar-nav">
                <a class="nav-link" href="/">In√≠cio</a>
                <a class="nav-link" href="/criar_servidor">Criar Servidor</a>
                <a class="nav-link" href="/config">Configura√ß√µes</a>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <h2>Informa√ß√µes do Servidor</h2>
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Status Geral</div>
                    <div class="card-body">
                        <p><strong>Nome:</strong> {{ servidor.nome or 'Servidor Exemplo' }}</p>
                        <p><strong>Caminho Pasta:</strong> {{ servidor.path or 'Null' }}</p>
                        <p><strong>Tipo:</strong> {{ servidor.tipo or 'Java Edition' }}</p>
                        <p><strong>Vers√£o:</strong> {{ servidor.versao or '1.20.1' }}</p>
                        <p><strong>Status:</strong> <span>{{servidor.status}}</span></p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Recursos</div>
                    <div class="card-body">
                        <p><strong>RAM Alocada:</strong> {{ servidor.ram or '0' }} GB</p>
                        <p><strong>RAM Usada:</strong> {{ servidor.ram_usada or '0' }} GB</p>
                        <p><strong>Jogadores Online:</strong> {{ servidor.jogadores or '0' }}/20</p>
                        <p><strong>Porta:</strong> {{ servidor.porta or '25565' }}</p>
                    </div>
                </div>
            </div>
        </div>

        <pre id="terminal"
            style="background:#000;color:#0f0;height:300px;overflow:auto;padding:10px;">
        </pre>

        <div class="card mt-3">
            <div class="card-header">Console</div>
            <div class="card-body">
                <div class="input-group">
                    <input
                        type="text"
                        id="cmdInput"
                        class="form-control"
                        placeholder="Digite um comando (ex: say Ol√° mundo)"
                        autocomplete="off"
                    >
                    <button class="btn btn-success" onclick="enviarComando()">
                        Enviar
                    </button>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <a href="/" class="btn btn-primary">Voltar ao In√≠cio</a>
            <button
                id="btnServidor"
                class="btn {{ 'btn-danger' if servidor.status == 'rodando' else 'btn-success' }}"
                onclick="toggleServidor({{ servidor.id }})">
                {{ 'Parar Servidor' if servidor.status == 'rodando' else 'Iniciar Servidor' }}
            </button>
            <button class="btn btn-danger btn-sm mt-2"
                    onclick="deletarServidor({{ servidor.id }})">
                üóë Excluir
            </button>
        </div>
    </div>

    <script>
    async function deletarServidor(id) {
        if (!confirm("Tem certeza que deseja excluir este servidor?")) {
            return;
        }

        const response = await fetch(`/api/servidores/${id}`, {
            method: 'DELETE'
        });

        const resultado = await response.json();

        if (resultado.sucesso) {
            alert("Servidor exclu√≠do com sucesso!");
            window.location.href = "/servidores";
        } else {
            alert("Erro ao excluir servidor");
        }
    }
    </script>

    <script>
    function toggleServidor(id) {

        fetch("/api/servidor/" + id + "/status")
            .then(function(response) {
                return response.json();
            })
            .then(function(status) {

                console.log("STATUS:", status);

                var rota;

                if (status.running === true) {
                    rota = "/api/servidor/" + id + "/stop";
                } else {
                    rota = "/api/servidor/" + id + "/start";
                }

                fetch(rota, { method: "POST" })
                    .then(function(response) {
                        return response.json();
                    })
                    .then(function(result) {
                        console.log("RESULT:", result);
                        location.reload();
                    });

            })
            .catch(function(error) {
                console.error("ERRO JS:", error);
                alert("Erro no JavaScript. Veja o console.");
            });
    }
    </script>

    <script>
    function atualizarLogs() {
        fetch(`/api/servidor/{{ servidor.id }}/logs`)
            .then(r => r.json())
            .then(logs => {
                const terminal = document.getElementById("terminal");
                terminal.textContent = logs.join("\n");
                // terminal.scrollTop = terminal.scrollHeight;
            });
    }

    setInterval(atualizarLogs, 2000);
    </script>

    <script>
    function enviarComando() {
        const input = document.getElementById("cmdInput");
        const comando = input.value.trim();

        if (!comando) return;

        fetch(`/api/servidor/{{ servidor.id }}/command`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ cmd: comando })
        })
        .then(r => r.json())
        .then(() => {
            input.value = "";
        })
        .catch(err => {
            console.error("Erro ao enviar comando:", err);
        });
    }

    // Enviar ao pressionar ENTER
    document.getElementById("cmdInput").addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
            enviarComando();
        }
    });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>